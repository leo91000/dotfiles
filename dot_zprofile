# zed or vscode
if [ "$TERM_PROGRAM" != "zed" ] && [ "$TERM_PROGRAM" != "vscode" ]; then
  if [ -z "$TMUX" ]; then
    # Ensure tpm plugins are installed and updated before starting tmux
    tmux_plugins_dir="$HOME/.tmux/plugins"
    tpm_dir="$tmux_plugins_dir/tpm"

    # Count the number of plugin directories excluding tpm
    plugin_count=$(fd --type d --max-depth 1 --exclude tpm . "$tmux_plugins_dir" | wc -l)

    if [ "$plugin_count" -eq 0 ]; then
      echo "Installing tmux plugins..."
      bash "$HOME/.tmux/plugins/tpm/scripts/install_plugins.sh" &>/dev/null
    fi

    tmux has-session -t main 2>/dev/null
    if [ $? -eq 0 ]; then
      echo "Attaching to tmux session 'main'..."
      tmux attach -t main
    else
      echo "Creating tmux session 'main'..."
      tmux new-session -s main
    fi
  fi
fi
